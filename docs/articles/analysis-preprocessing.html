<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>upbm: Pre-Processing Details • upbm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="upbm: Pre-Processing Details">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">upbm</a>
        <span class="version label label-info" data-toggle="tooltip" data-placement="bottom" title="GitHub pre-release">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/upbm-quickstart.html">Quick Start</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">General</li>
    <li>
      <a href="../articles/upbm-quickstart.html">Quickstart Guide</a>
    </li>
    <li>
      <a href="../articles/upbm-classes.html">PBM Class Details</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Analysis</li>
    <li>
      <a href="../articles/analysis-preprocessing.html">Sample Pre-Processing</a>
    </li>
    <li>
      <a href="../articles/analysis-summarization.html">Probe and K-mer Summarization</a>
    </li>
    <li>
      <a href="../articles/analysis-inference.html">K-mer-Level Inference</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Other</li>
    <li>
      <a href="../articles/other-qcplots.html">Quality Control Plots</a>
    </li>
    <li>
      <a href="../articles/other-tidydata.html">Tidy PBM Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/pkimes/upbm">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>upbm: Pre-Processing Details</h1>
                        <h4 class="author">Patrick K. Kimes</h4>
            
            <h4 class="date">11 February 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pkimes/upbm/blob/master/vignettes/analysis-preprocessing.Rmd"><code>vignettes/analysis-preprocessing.Rmd</code></a></small>
      <div class="hidden name"><code>analysis-preprocessing.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>For an introduction to the <em>upbm</em> package, please see the quick start vignette (<code><a href="../articles/upbm-quickstart.html">vignette("upbm-quickstart")</a></code>). Here, we provide details on the pre-processing steps briefly referenced in the quick start vignette. We assume basic knowledge of the <em>PBMExperiment</em> class (see <code><a href="../articles/upbm-classes.html">vignette("upbm-classes")</a></code>). The same example HOXC9 dataset from the <em>upbmData</em> package is used in this vignette to illustrate the various functions.</p>
<p>In the quick start vignette, the pre-processing steps were performed using the <code><a href="../reference/upbmPreprocess.html">upbm::upbmPreprocess</a></code> wrapper function. Here, we cover the individual pre-processing steps and underlying functions in more detail. Additionally, we introduce some plots which can be used to visualize the results of pre-processing at each step. The steps covered in this vignette include: background subtraction, Cy3 normalization, spatial adjustment, as well as within and across replicate normalization.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"upbm"</span>))</span></code></pre></div>
<p>Throughout, we will be using <code><a href="https://rdrr.io/pkg/broom/man/reexports.html">broom::tidy</a></code> to tidy data stored in <em>PBMExperiment</em> and <em>SummarizedExperiment</em> objects for interactive analysis and plotting (see <code><a href="../articles/other-tidydata.html">vignette("other-tidydata")</a></code>). We load the <em>dplyr</em> package to help with interactive analysis.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"dplyr"</span>))</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"ggplot2"</span>))</span></code></pre></div>
</div>
<div id="hoxc9-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#hoxc9-dataset" class="anchor"></a>HOXC9 Dataset</h1>
<p>For details on the example HOXC9 dataset, see the quick start vignette in this package or the <em>upbmData</em> package vignette. Here, we will use both Alexa488 and Cy3 scans.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(hoxc9alexa, <span class="dt">package =</span> <span class="st">"upbmData"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(hoxc9cy3, <span class="dt">package =</span> <span class="st">"upbmData"</span>)</span></code></pre></div>
<p>Here, we again use just single PMT gain scan for the Alexa488 scans.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>alexa_subset &lt;-<span class="st"> </span>hoxc9alexa[, <span class="kw">colData</span>(hoxc9alexa)<span class="op">$</span>pmt <span class="op">==</span><span class="st"> </span><span class="dv">450</span>]</span></code></pre></div>
</div>
<div id="background-subtraction" class="section level1">
<h1 class="hasAnchor">
<a href="#background-subtraction" class="anchor"></a>Background Subtraction</h1>
<p>Array scans stored as GPR files include both foreground and background intensity measures for each probe on the array. By default, both median foreground and background intensities are read in from GPR files and stored in the <em>PBMExperiment</em> objects when data are loaded using <code><a href="../reference/gpr2PBMExperiment.html">gpr2PBMExperiment(..)</a></code>. The foreground and background intensities are stored as separate <code>"fore"</code> and <code>"back"</code> assays in each object.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">assayNames</span>(alexa_subset)</span></code></pre></div>
<pre><code>## [1] "fore" "back"</code></pre>
<p>This default behavior can be changed to instead read mean (rather than median) foreground and background intensities, or to simply ignore background intensities by modifying the <code>useMedian =</code> and <code>readBackground =</code> parameters of <code>gprPBMExperiment(..)</code>.</p>
<p>The background intensities are useful for measuring non-specific fluorescence at each probe for each scan. Typically, background intensities are subtracted from foreground intensities to return “background subtracted intensities” (BSIs) for each probe. This is performed for both Alexa488 and Cy3 scans using <code><a href="../reference/backgroundSubtract.html">backgroundSubtract(..)</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>alexa_subset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/backgroundSubtract.html">backgroundSubtract</a></span>(alexa_subset, <span class="dt">assay =</span> <span class="st">"fore"</span>, <span class="dt">assayb =</span> <span class="st">"back"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>hoxc9cy3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/backgroundSubtract.html">backgroundSubtract</a></span>(hoxc9cy3, <span class="dt">assay =</span> <span class="st">"fore"</span>, <span class="dt">assayb =</span> <span class="st">"back"</span>)</span></code></pre></div>
<p>Rather than creating a new assay in the <em>PBMExperiment</em> objects, BSIs replace the <code>"fore"</code> assay values of each assay. Any probes which negative BSIs (corresponding to probes with background intensities greater than foreground intensities) are set to <code>NA</code>. This can be changed by setting <code>nonnegative = FALSE</code> in the call to <code><a href="../reference/backgroundSubtract.html">backgroundSubtract(..)</a></code>.</p>
<p>We take a look at the distribution of BSIs for each sample by tidying the new <code>"fore"</code> assay.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>tdat &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(alexa_subset, <span class="st">"fore"</span>, <span class="dt">long =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>tdat</span></code></pre></div>
<pre><code># # A tibble: 419,440 x 16
#    Column   Row probeID Sequence cname  fore   date version    id reuse
#     &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
#  1      6     1 dBr_14… GGTGTGA… s4     9051 170606 v14       226     1
#  2      7     1 dBr_06… CAGTCTA… s4    17547 170606 v14       226     1
#  3      8     1 dBr_39… CTTTTTA… s4    19086 170606 v14       226     1
#  4      9     1 dBr_06… CAGCTAC… s4     3720 170606 v14       226     1
#  5     10     1 dBr_05… GCTTCGA… s4     4100 170606 v14       226     1
#  6     15     1 dBr_16… CGCCCGT… s4    16224 170606 v14       226     1
#  7     23     1 dBr_20… TTAGCCC… s4     6165 170606 v14       226     1
#  8     24     1 dBr_25… TGCACAA… s4     3098 170606 v14       226     1
#  9     26     1 dBr_40… GGATGCC… s4     2917 170606 v14       226     1
# 10     27     1 dBr_21… GTCAGAA… s4     4006 170606 v14       226     1
# # … with 419,430 more rows, and 6 more variables: type &lt;chr&gt;, pmt &lt;dbl&gt;,
# #   idx &lt;dbl&gt;, target &lt;chr&gt;, condition &lt;chr&gt;, id_idx &lt;chr&gt;</code></pre>
<p>The column names from the <em>PBMExperiment</em> are stored in the <code>"cname"</code> column, along with allele information in <code>"condition"</code>, and plate IDs in <code>"id"</code>. We will use these annotations to stratify samples by plate and color by condition.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(tdat, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> fore, <span class="dt">group =</span> cname, <span class="dt">color =</span> condition)) <span class="op">+</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() <span class="op">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="st">"BSI (log2-scale)"</span>, <span class="dt">trans =</span> <span class="st">"log2"</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(id <span class="op">~</span><span class="st"> </span>., <span class="dt">labeller =</span> label_both) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Distributions of background subtracted intensities"</span>)</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## Warning: Removed 671 rows containing non-finite values (stat_density).</code></pre>
<p><img src="analysis-preprocessing_files/figure-html/bsi-density-1.png" width="576"></p>
<p>We can also take a look at the number of NA BSIs in each sample.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>tdat <span class="op">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(cname, id, condition) <span class="op">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">nNA =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(fore)),</span>
<span id="cb13-4"><a href="#cb13-4"></a>                     <span class="dt">pNA =</span> <span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(fore))) <span class="op">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(nNA)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   cname, id [10]
##    cname    id condition     nNA       pNA
##    &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;int&gt;     &lt;dbl&gt;
##  1 s5      226 HOXC9-R193K     0 0        
##  2 s34     264 HOXC9-R222W     2 0.0000477
##  3 s17     249 HOXC9-REF       5 0.000119 
##  4 s7      226 HOXC9-R222W     5 0.000119 
##  5 s4      226 HOXC9-REF       6 0.000143 
##  6 s19     249 HOXC9-K195R     7 0.000167 
##  7 s20     249 HOXC9-R222W     8 0.000191 
##  8 s18     249 HOXC9-R193K    14 0.000334 
##  9 s6      226 HOXC9-K195R    28 0.000668 
## 10 s33     264 HOXC9-REF     593 0.0141</code></pre>
<p>We see that one sample has over 500 NA values. However, since this is less than 2% of all probes, we do not worry too much.</p>
</div>
<div id="cy3-normalization" class="section level1">
<h1 class="hasAnchor">
<a href="#cy3-normalization" class="anchor"></a>Cy3 Normalization</h1>
<p>After background subtraction, we perform Cy3 normalization and filtering. In addition to Alexa488 scans which measure TF binding at each probeon an array, Cy3 scans are often also taken to measure dsDNA abundance at each probe. Briefly, small quantities of Cy3-conjugated dUTP are incorporated into the primer extension reactions (e.g. at 1:25 ratio against untagged dTTP) to measure double-stranding efficiency at each probe. The relative over or under abundance of Cy3-tagged dUTP at a probe on an array can be used to normalize for the relative abundance of dsDNA at each probe. Additionally, large deviations from expectation in Cy3 at a probe can be used to filter outlier probes from the Alexa488 data. dUTP abundance is highly dependent on probe sequence as noted in <span class="citation">Berger et al. (2006)</span>, making comparison across probes within arrays difficult. However, since dUPT abundance is independent of the assayed proteins, probe-level dUTP should be consistent across arrays with the same probe design. Therefore, the expected Cy3 intensity for each probe can be approximated using an empirical reference calculated using a large collection of Cy3 scans from arrays with the same design. An empirical reference calculated using 90 Cy3 scans is provided in the <em>upbmAux</em> package for the <code>v14</code> uPBM array design (corresponding array design <code>pbm_8x60k_v1</code>).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(refcy3_8x60k_v1, <span class="dt">package =</span> <span class="st">"upbmAux"</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a>refcy3_8x60k_v1</span></code></pre></div>
<pre><code>## class: PBMExperiment 
## dim: 62976 4 
## metadata(2): sfactor params
## assays(1): ref
## rownames: NULL
## rowData names(4): Column Row probeID Sequence
## colnames(4): probe_median probe_mean probe_mad probe_sd
## colData names(0):
## probeCols(4): Column Row probeID Sequence
## probeFilter names(1): probeID
## probeTrim: 1 36</code></pre>
<p>Given the reference distribution of probe intensities, the deviations from the expected Cy3 intensities can be calculated using <code><a href="../reference/cy3FitEmpirical.html">cy3FitEmpirical(..)</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>hoxc9cy3e &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cy3FitEmpirical.html">cy3FitEmpirical</a></span>(hoxc9cy3, refcy3_8x60k_v1)</span></code></pre></div>
<p>The returned <em>PBMExperiment</em> object includes the assays of the input <em>PBMExperiment</em> object along with 4 additional assays.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="kw">assayNames</span>(hoxc9cy3e)</span></code></pre></div>
<pre><code>## [1] "fore"     "back"     "expected" "ratio"    "scores"   "lowq"</code></pre>
<p>Most importantly, scaled observed-to-expected Cy3 intensities are stored in the <code>"scores"</code> assay along with binary TRUE/FALSE indicators for whether probes will be filtered as low quality in the <code>"lowq"</code> assay. The ratios are scaled to account for differences in cross-array varibility observed in the empirical distribution of Cy3 intensities. Intuitively, probes with lower adenine content and therefore dUTP incorporation and Cy3 intensities, will have different variability across replicate arrays than probes with higher Cy3 intensities. The cutoff for filtering probes can be modified by changing the <code>cutoff =</code> parameter of <code><a href="../reference/cy3FitEmpirical.html">cy3FitEmpirical(..)</a></code>.</p>
<p>Again, by tidying the data, we can take a look at the number of filtered probes for each sample.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>tdat &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(hoxc9cy3e, <span class="dt">assay =</span> <span class="st">"lowq"</span>, <span class="dt">long =</span> <span class="ot">TRUE</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>tdat <span class="op">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(cname, id, idx) <span class="op">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">nFilter =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(lowq)) <span class="op">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(nFilter)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 4
## # Groups:   cname, id [10]
##    cname    id   idx nFilter
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;int&gt;
##  1 s14     249     4       0
##  2 s15     249     5       0
##  3 s38     226     3       0
##  4 s40     226     7       0
##  5 s16     249     8       1
##  6 s39     226     6       3
##  7 s13     249     1       6
##  8 s37     226     2      17
##  9 s30     264     5    1728
## 10 s29     264     2    2141</code></pre>
<p>Interestingly, we see that the two samples from plate <code>264</code> have the highest number of filtered probes. We can also take a look at the distribution of observed-to-expected ratios in the <code>"ratio"</code> assay.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>tdat &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(hoxc9cy3e, <span class="dt">assay =</span> <span class="st">"ratio"</span>, <span class="dt">long =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Since the tidy data includes probe position information (row and column indices), we can plot the log2 ratios as a heatmap using the probe coordinates.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>tdat <span class="op">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(id <span class="op">==</span><span class="st"> </span><span class="dv">264</span>) <span class="op">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> Column, <span class="dt">y =</span> Row, <span class="dt">fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log2</a></span>(ratio))) <span class="op">+</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>() <span class="op">+</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>), <span class="dt">oob =</span> scales<span class="op">::</span>squish) <span class="op">+</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(. <span class="op">~</span><span class="st"> </span>idx, <span class="dt">labeller =</span> label_both) <span class="op">+</span></span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Cy3 log2 ratios for plate 264 (trimmed to [-1/2, 1/2])"</span>)</span></code></pre></div>
<p><img src="analysis-preprocessing_files/figure-html/cy3-plot-ratios-1.png" width="672"></p>
<p>There appears to be a slight spatial trend in the observed-to-expected ratios as well.</p>
<p>Next, we normalize the Alexa488 scans according to the relative over or under abundance of dsDNA as measured by Cy3. We use information in <code>"id_idx"</code>, a colData column which specifies the plate ID and array position of each scan in <code>alexa_subset</code> and <code>hoxc9cy3e</code> to uniquely match Alexa488 and Cy3 scans.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>alexa_subset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cy3Normalize.html">cy3Normalize</a></span>(<span class="dt">pe =</span> alexa_subset, <span class="dt">cy3pe =</span> hoxc9cy3e, <span class="dt">match_by =</span> <span class="st">"id_idx"</span>)</span></code></pre></div>
<p>The returned <em>PBMExperiment</em> contains the Cy3-normalized Alexa488 probe intensities as a new <code>"normalized"</code> assay. By default, probes identified as low quality are set to NA, and all other probes are normalized according to the observed-to-expected Cy3 ratios. This can be changed by setting <code>filter = FALSE</code> or <code>scale = FALSE</code> in <code><a href="../reference/cy3Normalize.html">cy3Normalize(..)</a></code>.</p>
</div>
<div id="spatial-adjustment" class="section level1">
<h1 class="hasAnchor">
<a href="#spatial-adjustment" class="anchor"></a>Spatial Adjustment</h1>
<p>Next, we perform spatial adjustment to correct for bias due to uneven distribution of the protein across each array. This step requires row and column coordinates be specified for all probes as <code>"Row"</code> and <code>"Column"</code> columns in the rowData (taken from the <em>PBMDesign</em> specified when reading the GPR data). Probe coordinates are specified for all standard uPBM designs included in the <em>upbmAux</em> package. Note that while we saw a slight spatial pattern in the Cy3 bias, the spatial adjustment performed here corrects for a separate bias introduced at a downstream step of the experimental process.</p>
<p>Spatial adjustment is performed as described in <span class="citation">Berger et al. (2006)</span> and <span class="citation">Berger and Bulyk (2009)</span>. Briefly, the median probe intensity within a <em>K</em>-by-<em>K</em> region around each probe is compared to the median probe intensity across the entire array. Since probes are positioned randomly across the array, difference between the local median around a probe and the global median is considered spatial bias which should be removed. By default, <em>K</em> is set to 15. However, this can be changed by specifying <code>k =</code> when calling <code><a href="../reference/spatiallyAdjust.html">spatiallyAdjust(..)</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>alexa_subset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/spatiallyAdjust.html">spatiallyAdjust</a></span>(alexa_subset)</span></code></pre></div>
<p>The spatially adjusted probe intensities are stored in the <code>"normalized"</code> assay, overwritting the previous data in this assay (if Cy3 normalization was performed). The returned <em>PBMExperiment</em> includes only the subset of probes passing the filtering criteria specified in the <code>probeFiter</code> slot of the <em>PBMExperiment</em> taken from the <em>PBMDesign</em> specified when reading the GPR data (for more details, see: <em>upbm: Class Details</em>). In this case, this includes all probes with probe IDs prefixed by <code>dBr_</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">rowData</span>(alexa_subset)</span></code></pre></div>
<pre><code>## DataFrame with 41944 rows and 4 columns
##          Column       Row         probeID
##       &lt;integer&gt; &lt;integer&gt;     &lt;character&gt;
## 1             6         1 dBr_14334_Jan07
## 2             7         1 dBr_06208_Jan07
## 3             8         1 dBr_39317_Jan07
## 4             9         1 dBr_06987_Jan07
## 5            10         1 dBr_05074_Jan07
## ...         ...       ...             ...
## 41940       177       328 dBr_41722_Jan07
## 41941       182       328 dBr_41538_Jan07
## 41942       186       328 dBr_02271_Jan07
## 41943       187       328 dBr_19625_Jan07
## 41944       189       328 dBr_29130_Jan07
##                                                           Sequence
##                                                        &lt;character&gt;
## 1     GGTGTGAGTCCATTTCGTCAAACCAACGCAACAGGTGTCTGTGTTCCGTTGTCCGTGCTG
## 2     CAGTCTAAGTTTTCGGATTACCATTAGAAATTGATGGTCTGTGTTCCGTTGTCCGTGCTG
## 3     CTTTTTAAAGACCTAGGAATCATTGCATTCTTATTGGTCTGTGTTCCGTTGTCCGTGCTG
## 4     CAGCTACGGAAGAGTAAAGGTTGTCGAAGCCGTGCAGTCTGTGTTCCGTTGTCCGTGCTG
## 5     GCTTCGAACGTGGGCGATGGAACAAGTCGCAGTCATGTCTGTGTTCCGTTGTCCGTGCTG
## ...                                                            ...
## 41940 GATGAAGGTACTCTCTTGCACCGTTACACGATTAACGTCTGTGTTCCGTTGTCCGTGCTG
## 41941 CTGTACTCCTGCACAGCGGAAACTGAGGGTCGTTGAGTCTGTGTTCCGTTGTCCGTGCTG
## 41942 CCCCGTAGCGGGAAACTATTGAGACTGCCTTATCTGGTCTGTGTTCCGTTGTCCGTGCTG
## 41943 TCTAGATTCCAGGTCCATCTTCCTCGTCCACAAGAAGTCTGTGTTCCGTTGTCCGTGCTG
## 41944 TACCATTTTATAGACAATGGACACCATTGCATGGTTGTCTGTGTTCCGTTGTCCGTGCTG</code></pre>
<p>By default, the returned <em>PBMExperiment</em> includes the spatial bias estimates for each probe in the <code>"spatialbias"</code> assay. This can be changed by setting <code>returnBias = FALSE</code>.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">assayNames</span>(alexa_subset)</span></code></pre></div>
<pre><code>## [1] "normalized"  "fore"        "back"        "spatialbias"</code></pre>
<p>The spatial bias is stored as the local-to-global ratio, and can be plotted as before by tidying the assay data.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>tdat &lt;-<span class="st"> </span>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(alexa_subset, <span class="dt">assay =</span> <span class="st">"spatialbias"</span>, <span class="dt">long =</span> <span class="ot">TRUE</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a>tdat <span class="op">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> Column, <span class="dt">y =</span> Row, <span class="dt">fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/Log.html">log2</a></span>(spatialbias))) <span class="op">+</span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>() <span class="op">+</span></span>
<span id="cb30-6"><a href="#cb30-6"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span>(<span class="st">"log2 ratio"</span>, <span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">oob =</span> scales<span class="op">::</span>squish) <span class="op">+</span></span>
<span id="cb30-7"><a href="#cb30-7"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></span>
<span id="cb30-8"><a href="#cb30-8"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(id <span class="op">~</span><span class="st"> </span>condition, <span class="dt">labeller =</span> label_both) <span class="op">+</span></span>
<span id="cb30-11"><a href="#cb30-11"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Spatial bias; log2 ratio (trimmed to [-1, 1])"</span>)</span></code></pre></div>
<p><img src="analysis-preprocessing_files/figure-html/spadj-plot-bias-1.png" width="768"></p>
<p>In general, probes near the edges of arrays appear to be more negatively biased relative to probes near the center of each array.</p>
</div>
<div id="cross-sample-normalization" class="section level1">
<h1 class="hasAnchor">
<a href="#cross-sample-normalization" class="anchor"></a>Cross-Sample Normalization</h1>
<p>All prior pre-processing steps considered arrays separately. We next normalize <em>across</em> arrays in two steps - first within replicates with <code>normalieWithinReplicates(..)</code>, and second across replicates with <code><a href="../reference/normalizeAcrossReplicates.html">normalizeAcrossReplicates(..)</a></code>. Plate and condition information should be specified in the colData of the <em>PBMExperiment</em> object. By default, the normalization functions expect plate and condition labels to be included in columns named <code>"id"</code> and <code>"condition"</code>. The condition and replicate ID colData columns can also be specified using the <code>stratify =</code> and <code>group =</code> parameters, respectively.</p>
<p>Additionally, within replicate normalization scales probe intensities to match a single baseline (reference) sample in the replicate. The baseline sample condition can be specified with the <code>baseline =</code> parameter. A single matching sample with the specified value in the <code>stratify =</code> column will be used as the baseline for normalization. If the baseline condition is not explicity specified, the function will attempt to guess the baseline condition by checking for any conditions ending in <code>-ref</code> (case insensitive). Here, <code>"HOXC9-REF"</code> will be used as the baseline condition.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">colData</span>(alexa_subset)<span class="op">$</span>condition</span></code></pre></div>
<pre><code>##  [1] "HOXC9-REF"   "HOXC9-R193K" "HOXC9-K195R" "HOXC9-R222W" "HOXC9-REF"  
##  [6] "HOXC9-R193K" "HOXC9-K195R" "HOXC9-R222W" "HOXC9-REF"   "HOXC9-R222W"</code></pre>
<p>Since the baseline condition ends in <code>-REF</code>, we do not need to explicitly specify the value to the function. Details on the normalization procedure is provided in the function documentation. By default, a simplified trimmed mean of M values (TMM) approach is used <span class="citation">(Robinson and Oshlack 2010)</span>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>alexa_subset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/normalizeWithinReplicates.html">normalizeWithinReplicates</a></span>(alexa_subset)</span></code></pre></div>
<p>We now replot the normalized probe intensities and see that within each replicate, intensity distributions no longer differ by global differences (see distribution of BSIs above).</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(alexa_subset, <span class="dt">long =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> normalized, <span class="dt">group =</span> cname, <span class="dt">color =</span> condition)) <span class="op">+</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() <span class="op">+</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="st">"normalized intensity (log2-scale)"</span>, <span class="dt">trans =</span> <span class="st">"log2"</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(id <span class="op">~</span><span class="st"> </span>., <span class="dt">labeller =</span> label_both) <span class="op">+</span><span class="st"> </span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Distributions of within replicate normalized intensities"</span>)</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## Warning: Removed 4514 rows containing non-finite values (stat_density).</code></pre>
<p><img src="analysis-preprocessing_files/figure-html/norm-within-density-1.png" width="576"></p>
<p>Next, samples are normalized across replicates. Notice above that log-scale normalized intensities not only differ by a shift but also a scaling factor between replicates. Cross-replicate normalization adjusts for both of these differences. Again, details on the approach used for estimating the normalization factors are described in the function documentation. However, note that normalization across replicates is performed using matching conditions across replicates. Initially, normalization is attempted using only the baseline condition samples. If some replicates do not contain baseline samples, they are normalized to the remaining (baseline sample containing) replicates using any other shared conditions. If a replicate does not share any sample conditions with any other replicates, it cannot be normalized. Therefore, <strong>cross-replicate (cross-plate) normalization will fail if any conditions are completely confounded with plates.</strong> If this is the case, we recommend using the rank-based approaches implemented in the <em>Universal PBM Analysis Suite</em> <span class="citation">(Berger and Bulyk 2009)</span>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>alexa_subset &lt;-<span class="st"> </span><span class="kw"><a href="../reference/normalizeAcrossReplicates.html">normalizeAcrossReplicates</a></span>(alexa_subset)</span></code></pre></div>
<p>Again, we can replot the normalized probe intensities after cross-replicate normalization.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>broom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(alexa_subset, <span class="dt">long =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> normalized, <span class="dt">group =</span> cname, <span class="dt">color =</span> condition)) <span class="op">+</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span>() <span class="op">+</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="st">"normalized intensity (log2-scale)"</span>, <span class="dt">trans =</span> <span class="st">"log2"</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(id <span class="op">~</span><span class="st"> </span>., <span class="dt">labeller =</span> label_both) <span class="op">+</span><span class="st"> </span></span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() <span class="op">+</span></span>
<span id="cb38-7"><a href="#cb38-7"></a><span class="st">    </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Distributions of cross-replicate normalized intensities"</span>)</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## Warning: Removed 4514 rows containing non-finite values (stat_density).</code></pre>
<p><img src="analysis-preprocessing_files/figure-html/norm-across-density-1.png" width="576"></p>
<p>Normalized intensities are now roughly comparable across replicates and can now be passed to downstream modeling and inference steps.</p>
</div>
<div id="wrapper-function" class="section level1">
<h1 class="hasAnchor">
<a href="#wrapper-function" class="anchor"></a>Wrapper Function</h1>
<p>In general, the default normalization parameters should be sufficient for most analyses. In this case, the <code><a href="../reference/upbmPreprocess.html">upbmPreprocess(..)</a></code> wrapper can be used to quickly run all of the above steps with a single command.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co">## not run</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="kw"><a href="../reference/upbmPreprocess.html">upbmPreprocess</a></span>(<span class="dt">pe =</span> alexa_subset, <span class="dt">cy3pe =</span> hoxc9cy3, <span class="dt">cy3refpe =</span> refcy3_8x60k_v1)</span></code></pre></div>
<p>Additionally, non-default parameters can be specified to <code><a href="../reference/upbmPreprocess.html">upbmPreprocess(..)</a></code> using <code>params =</code>. The parameter takes a named list of named parameter values which will be used when the corresponding step is called in the pre-processing pipeline. If a pre-processing step should be skipped, this can also be specified with the <code>skip =</code> parameter. Examples of these parameters are provided in the function documentation.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-berger2009">
<p>Berger, Michael F, and Martha L Bulyk. 2009. “Universal Protein-Binding Microarrays for the Comprehensive Characterization of the Dna-Binding Specificities of Transcription Factors.” <em>Nature Protocols</em> 4 (3): 393–411.</p>
</div>
<div id="ref-berger2006">
<p>Berger, Michael F, Anthony A Philippakis, Aaron M Qureshi, Fangxue S He, Preston W Estep III, and Martha L Bulyk. 2006. “Compact, Universal Dna Microarrays to Comprehensively Determine Transcription-Factor Binding Site Specificities.” <em>Nature Biotechnology</em> 24 (11): 1429–35.</p>
</div>
<div id="ref-robinson2010">
<p>Robinson, Mark D, and Alicia Oshlack. 2010. “A Scaling Normalization Method for Differential Expression Analysis of Rna-Seq Data.” <em>Genome Biology</em> 11 (3): R25.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#hoxc9-dataset">HOXC9 Dataset</a></li>
      <li><a href="#background-subtraction">Background Subtraction</a></li>
      <li><a href="#cy3-normalization">Cy3 Normalization</a></li>
      <li><a href="#spatial-adjustment">Spatial Adjustment</a></li>
      <li><a href="#cross-sample-normalization">Cross-Sample Normalization</a></li>
      <li><a href="#wrapper-function">Wrapper Function</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.pkimes.com">Patrick Kimes</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
